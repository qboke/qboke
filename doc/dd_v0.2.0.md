Design Draft For V0.2.0
=======================

1. 概述
-------

这一版要实现的功能有：

  * 自动检出
  
    包括 git、svn、自定义脚本，后期还可以增加各种网盘的支持，如 Dropbox、SkyDrive、Google Drive 等。
    
  * 多目录支持
  
    该功能主要是为了支持多用户、多站点以及更灵活的组织方式。
    
    比如，用户 A 和 B 公用一个空间，A 的内容在 /var/a 下，B 的内容在 /var/b 下，并且 A 使用的是 git，B 使用的是 svn 。
    
    再比如，B 只是负责 A 的站点的某一频道，则 B 可以把内容放到 /var/a/b 下。但自动检出时，还是独立的。
    
  * 多站点支持
  
    此功能是本系统的亮点。这样，本系统既可以为个人架设私有站点，又可以为空间供应商（或内容负责的个人站点）架设多用户站点。
    
    特别的，要支持子站点、站点嵌套等功能。
    
    比如，A 的内容在 /var/a 下，其下有个 /var/a/subsite 子目录。其内容可以通过 http://www.a.com/subsite/ 来访问，如果作为子站点的话，还可以通过 http://sub.a.com/ 来访问。
    
    如果为 /var/a/subsite 设置一个其他的域名（如 www.x.com），那它就会是一个独立的站点 http://www.x.com/ 了。这看起来就像站点 http://www.a.com 嵌套了站点 http://www.x.com/ 一样。这就是“站点嵌套”了。
    
    你可以为某一路径设置多个域名的。比如，www.a.com，www.a.net，www.a.org 。

  * 路径别名
  
    你可以设置使用 http://www.a.com/sub/ 来访问 /var/a/subsite 下的内容。

要实现这些功能，需要用户提供相应的配置。

2. 配置
-------

本系统的大部分配置文件都采用 json 格式，并以 .json 作为后缀名。

有些配置文件的名字是以 . 开头的。这样，在 Linux 系统下其表现为隐藏文件。这样是为了取悦于那些有视觉洁癖的人。

### 2.1. 系统的配置

整个系统的配置，在本系统的根目录下的 config.json 中。仅配置必须的路径和自动检出参数。

<pre>
[
  {
    "path" : "",
    "type" : "git",
    "user" : "",
    "pass" : "",
    "remote" : "",
    "branch" : ""
  },{
    "path" : "",
    "type" : "svn",
    "user" : "",
    "pass" : "",
    "url"  : ""
  ｝
]
</pre>

### 2.2. 站点的配置

如果你想把某个目录下的内容（包括子目录）做为一个站点，只需在该目录下创建一个名为 .site.json 的文件。

该配置文件中唯一必须配置的参数是站点的域名和根路径，比如，http://www.a.com/blog/ 。其他的都不是必须的。还有一些参数你最好也配置一下，比如站点名。

<pre>
{
  "name" : "",
  "desc" : "",
  "theme": "default",
  "linage": 20,
  ...
}
</pre>

### 2.3. 路径的配置

一般情况下，站点所在目录下的子目录，都会被我们认为是一个分类。如果你想让你的看上去更好一些，你可能需要为分类指定一些个性化的东西。这些配置是保存在该目录下的 .meta.json 文件中的。

<pre>
{
  "name" : "",
  "alias": "",
  "ignore": ["x.md", "y.md", "z.rst", "subdir"]
}
</pre>

### 2.4. 文章的配置

同样的，为了个性化文章，你可能需要为单个文章配置属性。比如，你或许希望指定文章的 url 为 SEO 友好的；你或许会给文章打上几个标签；甚至，你或许会为某篇文章写个摘要。

这些配置应该在文章所在文件中最开始部分的注释中。举例来说，markdown 格式的注释是以 <code>&lt;!-- --></code> 框起来的部分。

<pre>
<!--
{
  "title" : "",
  "alias" : "",
  "author": "",
  "date"  : "2013-05-27 23:28:04",
  "format": "markdown",
  "tags"  : ["xxx", "yyy", "zzz"],
  "opts"  : {}
}
-->
</pre>

3. 部分数据结构
-------------

### 3.1. 文章列表

文章的属性是从文件开头的注释部分提取的。各属性都是可选的，没有特别指定就使用默认的方式，比如 lname 用文件名， date 用文件的更新时间等。

key 为文件的编号，按时间逆序，value 为文章的各种属性。

<pre>
[
  {
    "path"  : "/var/a/x.md",
    "lname" : "x.html",
    "title" : "",
    "date"  : "",
    "author": "",
    ...
  },{
    "path"  : "/var/a/b/y.rst",
    "lname" : "y.html",
    "title" : "",
    ...
  }
]
</pre>

### 3.2. 标签

key 为标签名，value 为此标签下的文章编号（按时间逆序）。

按目录分类也可以作为一种特殊的标签。

<pre>
{
  "work" : [1, 3, 7],
  "life" : [2, 4],
  "fun"  : [5, 6]
}
</pre>

### 3.3. 


